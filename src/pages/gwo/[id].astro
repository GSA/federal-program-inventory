---
import Layout from "../../layouts/Layout.astro";
import { getObjectiveData } from "../../utils/objectiveData";
import { ObjectiveHeader } from "../../components/objective/ObjectiveHeader";
import { ObjectiveTabs } from "../../components/objective/ObjectiveTabs";

import programsSummary from "../../../data/programs.json";

export async function getStaticPaths() {
    // Get all unique GWO IDs from programs
    const gwoIds = new Set(
        programsSummary.filter((p) => p.gwo && p.gwo.id).map((p) => p.gwo.id),
    );

    const paths = Array.from(gwoIds).map((id) => ({
        params: { id },
    }));

    // Add the hardcoded example if not present
    if (!gwoIds.has("sustain-public-roadway-system")) {
        paths.push({ params: { id: "sustain-public-roadway-system" } });
    }

    return paths;
}

const { id } = Astro.params;
console.log("Objective Page ID:", id);
const objectiveData = getObjectiveData(id);

if (!objectiveData) {
    return Astro.redirect("/404");
}
---

<Layout title={`${objectiveData.title} | Federal Program Inventory`}>
    <main class="px-4 sm:px-6 lg:px-8 pb-16 pt-10">
        <div class="max-w-7xl mx-auto">
            <ObjectiveHeader
                client:load
                title={objectiveData.title}
                description={objectiveData.description}
                updated={objectiveData.updated}
                tags={objectiveData.tags}
            />

            <div class="border-t border-parchment-500 mt-5"></div>

            <ObjectiveTabs
                client:load
                programs={objectiveData.programs}
                totalExpenditure={objectiveData.totalExpenditure}
                lastUpdated={objectiveData.updated}
            />
        </div>
    </main>
</Layout>
